version: 43
jobs:
- name: CI
  steps:
  - type: CheckoutStep
    name: checkout code
    cloneCredential:
      type: DefaultCredential
    withLfs: false
    withSubmodules: false
    cloneDepth: 1
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW
    runInContainer: true
    image: mcr.microsoft.com/dotnet/sdk:10.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW/
        dotnet build -c @param:build_configuration@ SimpleW.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW.JsonEngine.Newtonsoft
    runInContainer: true
    image: mcr.microsoft.com/dotnet/sdk:10.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW.JsonEngine.Newtonsoft/
        dotnet build -c @param:build_configuration@ SimpleW.JsonEngine.Newtonsoft.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW.Helper.Hosting
    runInContainer: true
    image: mcr.microsoft.com/dotnet/sdk:10.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW.Helper.Hosting/
        dotnet build -c @param:build_configuration@ SimpleW.Helper.Hosting.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW.Service.Firewall
    runInContainer: true
    image: mcr.microsoft.com/dotnet/sdk:10.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW.Service.Firewall/
        dotnet build -c @param:build_configuration@ SimpleW.Service.Firewall.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: test
    runInContainer: true
    image: mcr.microsoft.com/dotnet/sdk:10.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/test/
        dotnet test
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: PublishArtifactStep
    name: publish artifact
    sourcePath: src/SimpleW/bin/@param:build_configuration@/
    artifacts: '*/SimpleW.dll'
    condition: SUCCESSFUL
    optional: false
  paramSpecs:
  - type: ChoiceParam
    name: build_configuration
    description: Build Configuration
    allowMultiple: false
    allowEmpty: false
    choiceProvider:
      type: SpecifiedChoices
      choices:
      - value: Release
        color: '#0d87e9'
      - value: Debug
        color: '#0d87e9'
    defaultValueProvider:
      type: SpecifiedDefaultValue
      value: Release
  triggers:
  - type: BranchUpdateTrigger
    paths: src/SimpleW/ src/test/
    userMatch: anyone
    paramMatrix:
    - valuesProvider:
        type: SpecifiedValues
        values:
        - - Release
      secret: false
      name: build_configuration
  retryCondition: never
  maxRetries: 3
  retryDelay: 30
  timeout: 3600
- name: CD nuget
  steps:
  - type: CheckoutStep
    name: checkout code
    cloneCredential:
      type: DefaultCredential
    withLfs: false
    withSubmodules: false
    cloneDepth: 1
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW
    runInContainer: true
    image: mcr.microsoft.com/dotnet/sdk:10.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW
        TS=$(date +"%Y%m%d-%H%M")
        sed -i -E "s#<Version>([0-9]+\.[0-9]+\.[0-9]+-(alpha|beta|rc))</Version>#<Version>\\1.${TS}</Version>#g" SimpleW.csproj
        dotnet pack -c Release SimpleW.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW.JsonEngine.Newtonsoft
    runInContainer: true
    image: mcr.microsoft.com/dotnet/sdk:10.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW.JsonEngine.Newtonsoft
        TS=$(date +"%Y%m%d-%H%M")
        sed -i -E "s#<Version>([0-9]+\.[0-9]+\.[0-9]+-(alpha|beta|rc))</Version>#<Version>\\1.${TS}</Version>#g" SimpleW.JsonEngine.Newtonsoft.csproj
        dotnet pack -c Release SimpleW.JsonEngine.Newtonsoft.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW.Helper.Hosting
    runInContainer: true
    image: mcr.microsoft.com/dotnet/sdk:10.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW.Helper.Hosting
        TS=$(date +"%Y%m%d-%H%M")
        sed -i -E "s#<Version>([0-9]+\.[0-9]+\.[0-9]+-(alpha|beta|rc))</Version>#<Version>\\1.${TS}</Version>#g" SimpleW.Helper.Hosting.csproj
        dotnet pack -c Release SimpleW.Helper.Hosting.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW.Service.Firewall
    runInContainer: true
    image: mcr.microsoft.com/dotnet/sdk:10.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW.Service.Firewall
        TS=$(date +"%Y%m%d-%H%M")
        sed -i -E "s#<Version>([0-9]+\.[0-9]+\.[0-9]+-(alpha|beta|rc))</Version>#<Version>\\1.${TS}</Version>#g" SimpleW.Service.Firewall.csproj
        dotnet pack -c Release SimpleW.Service.Firewall.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: PublishArtifactStep
    name: publish artifact SimpleW
    sourcePath: src/SimpleW/bin/Release/
    artifacts: '*.*nupkg'
    condition: SUCCESSFUL
    optional: false
  - type: PublishArtifactStep
    name: publish artifact SimpleW.JsonEngine.Newtonsoft
    sourcePath: src/SimpleW.JsonEngine.Newtonsoft/bin/Release/
    artifacts: '*.*nupkg'
    condition: SUCCESSFUL
    optional: false
  - type: PublishArtifactStep
    name: publish artifact SimpleW.Helper.Hosting
    sourcePath: src/SimpleW.Helper.Hosting/bin/Release/
    artifacts: '*.*nupkg'
    condition: SUCCESSFUL
    optional: false
  - type: PublishArtifactStep
    name: publish artifact SimpleW.Service.Firewall
    sourcePath: src/SimpleW.Service.Firewall/bin/Release/
    artifacts: '*.*nupkg'
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: deploy SimpleW to nuget.org
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW/bin/Release
        dotnet nuget push *.nupkg --api-key @secret:nuget_token@ --source https://api.nuget.org/v3/index.json
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: deploy SimpleW.JsonEngine.Newtonsoft to nuget.org
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW.JsonEngine.Newtonsoft/bin/Release
        dotnet nuget push *.nupkg --api-key @secret:nuget_token@ --source https://api.nuget.org/v3/index.json
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: deploy SimpleW.Helper.Hosting to nuget.org
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW.Helper.Hosting/bin/Release
        dotnet nuget push *.nupkg --api-key @secret:nuget_token@ --source https://api.nuget.org/v3/index.json
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: deploy SimpleW.Service.Firewall to nuget.org
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/SimpleW.Service.Firewall/bin/Release
        dotnet nuget push *.nupkg --api-key @secret:nuget_token@ --source https://api.nuget.org/v3/index.json
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  jobDependencies:
  - jobName: CI
    requireSuccessful: true
    paramMatrix:
    - valuesProvider:
        type: SpecifiedValues
        values:
        - - Release
      secret: false
      name: build_configuration
  retryCondition: never
  maxRetries: 3
  retryDelay: 30
  timeout: 3600
- name: CM github
  steps:
  - type: PushRepository
    name: push
    remoteUrl: https://github.com/stratdev3/SimpleW
    passwordSecret: github_token
    force: true
    condition: SUCCESSFUL
    optional: false
  jobDependencies:
  - jobName: CI
    requireSuccessful: true
    paramMatrix:
    - valuesProvider:
        type: SpecifiedValues
        values:
        - - Release
      secret: false
      name: build_configuration
  retryCondition: never
  maxRetries: 3
  retryDelay: 30
  timeout: 3600
- name: CI v16
  steps:
  - type: CheckoutStep
    name: checkout code
    cloneCredential:
      type: DefaultCredential
    withLfs: false
    withSubmodules: false
    cloneDepth: 1
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/v16/SimpleW/
        dotnet build -c @param:build_configuration@ SimpleW.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW.Newtonsoft
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/v16/SimpleW.Newtonsoft/
        dotnet build -c @param:build_configuration@ SimpleW.Newtonsoft.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: test
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/v16/test/
        dotnet test
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: PublishArtifactStep
    name: publish artifact SimpleW
    sourcePath: src/v16/SimpleW/bin/@param:build_configuration@/
    artifacts: '*/SimpleW.dll'
    condition: SUCCESSFUL
    optional: false
  - type: PublishArtifactStep
    name: publish artifact SimpleW.Newtonsoft
    sourcePath: src/v16/SimpleW.Newtonsoft/bin/@param:build_configuration@/
    artifacts: '*/v16/SimpleW.Newtonsoft.dll'
    condition: SUCCESSFUL
    optional: false
  paramSpecs:
  - type: ChoiceParam
    name: build_configuration
    description: Build Configuration
    allowMultiple: false
    allowEmpty: false
    choiceProvider:
      type: SpecifiedChoices
      choices:
      - value: Release
        color: '#0d87e9'
      - value: Debug
        color: '#0d87e9'
    defaultValueProvider:
      type: SpecifiedDefaultValue
      value: Release
  triggers:
  - type: BranchUpdateTrigger
    paths: src/v16/SimpleW/ src/v16/SimpleW.Newtonsoft/ src/v16/test/
    userMatch: anyone
    paramMatrix:
    - valuesProvider:
        type: SpecifiedValues
        values:
        - - Release
      secret: false
      name: build_configuration
  retryCondition: never
  maxRetries: 3
  retryDelay: 30
  timeout: 3600
- name: CD v16 nuget
  steps:
  - type: CheckoutStep
    name: checkout code
    cloneCredential:
      type: DefaultCredential
    withLfs: false
    withSubmodules: false
    cloneDepth: 1
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/v16/SimpleW
        dotnet pack -c Release SimpleW.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: build SimpleW.Newtonsoft
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/v16/SimpleW.Newtonsoft
        dotnet pack -c Release SimpleW.Newtonsoft.csproj
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: PublishArtifactStep
    name: publish artifact SimpleW
    sourcePath: src/v16/SimpleW/bin/Release/
    artifacts: '*.*nupkg'
    condition: SUCCESSFUL
    optional: false
  - type: PublishArtifactStep
    name: publish artifact SimpleW.Newtonsoft
    sourcePath: src/v16/SimpleW.Newtonsoft/bin/Release/
    artifacts: '*.*nupkg'
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: deploy SimpleW to nuget.org
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/v16/SimpleW/bin/Release
        dotnet nuget push *.nupkg --api-key @secret:nuget_token@ --source https://api.nuget.org/v3/index.json
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  - type: CommandStep
    name: deploy SimpleW.Newtonsoft to nuget.org
    runInContainer: true
    image: docksdev/band:8.0
    interpreter:
      type: DefaultInterpreter
      commands: |
        cd src/v16/SimpleW.Newtonsoft/bin/Release
        dotnet nuget push *.nupkg --api-key @secret:nuget_token@ --source https://api.nuget.org/v3/index.json
    useTTY: false
    condition: SUCCESSFUL
    optional: false
  jobDependencies:
  - jobName: CI v16
    requireSuccessful: true
    paramMatrix:
    - valuesProvider:
        type: SpecifiedValues
        values:
        - - Release
      secret: false
      name: build_configuration
  retryCondition: never
  maxRetries: 3
  retryDelay: 30
  timeout: 3600